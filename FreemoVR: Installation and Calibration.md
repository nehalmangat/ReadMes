# FreemoVR: Installation and Calibration
Freemovr is a system based on ROS-nodes for creating a dynamic virtual reality for freely moving animals. I highly recommend familiarity with [ROS](http://wiki.ros.org/ROS/Tutorials) before starting the Freemovr installation.

## Conceptual Basics
The FreemoVR system is composed of two subsystems:

[freemovr_engine](https://github.com/strawlab/freemovr_engine): renders a dynamic virtual scene based on position

[flydra](https://github.com/strawlab/flydra) (superseded by [braid](https://strawlab.org/braid/)): 3D-tracking software that collects positional information of targets

Note: braid publishes its data to a local port by default. To import braid data into the freemovr_engine, you will need a ROS node that listens to that local port and publishes that data in the freemovr_engine environment.  

## Installation
### freemovr_engine
Please follow the installation instructions [here](https://github.com/strawlab/strawlab-ansible-roles.git). 
### braid
Please follow the installation instructions [here](https://github.com/strawlab/strand-braid). 

## Calibration
Once you have completed the installation and confirmed everything works per the installation pages, the next steps will be to calibrate your projector so that the virtual scene cast onto the projection surface will be projected in scale. 

1) I highly recommend using [OBS studio](https://obsproject.com/) for a clean and intuitive casting of the virtual scene window to the projector.
2) Using a sample image that we project onto our projection surface, we find the mapping of the pixels within our image window to the physical location on the projection surface. The following website was created by Andrew Straw to assist in this process: [FreemoVR Pinhole Calibration Tool - Alpha Release](https://strawlab.org/vr-cal/)
3) If all works well, the new virtual reality generated by the freemovr_engine will be calibrated to your projector and projection surface.
##### FreemoVR Pinhole Calibration Tool (Explanation)
* [OPJ file](https://www.makeuseof.com/what-is-an-obj-file/): You can create such files using a 3D-editor such as [Blender](https://www.blender.org/). It is most convenient to define the object axes according to standard window conventions i.e. + x-axis is left-to-right, + y-axis is up-to-down
* Calibration image ([UV grid](https://en.wikipedia.org/wiki/UV_mapping)): Use an [existing UV grid](https://github.com/strawlab/strand-braid/blob/main/freemovr-calibration/freemovr-calibration-webapp/static/UV_Grid_Sm.jpg), [create your own](https://www.youtube.com/watch?v=eqzTaJDpnck), or use an image you feel comfortable calibrating with. 
* the generated [EXR file](https://www.lifewire.com/exr-file-2621157) must then be put in the appropriate freemovr_engine environment. Find where the freemovr_engine display_server draws its EXR files from (this info should be in the launch file), and then place the EXR file there. 
